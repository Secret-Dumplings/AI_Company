<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI协作对话系统</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI','Microsoft YaHei',sans-serif}
        body{background:linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}
        .container{width:100%;max-width:900px;background:#fff;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.3);overflow:hidden;display:flex;flex-direction:column;border:2px solid #333}
        .header{background:linear-gradient(to right,#4e54c8,#8f94fb);color:#fff;padding:15px;text-align:center;border-bottom:2px solid #333}
        .header h1{font-size:1.5rem;margin-bottom:5px}
        .header p{font-size:.9rem;opacity:.9}
        .input-section{padding:15px;border-bottom:2px solid #333;background:#fff}
        .user-input-box{border:2px solid #333;border-radius:5px;padding:10px;background:#f9f9f9}
        .user-input{width:100%;padding:10px;border:1px solid #ddd;border-radius:5px;font-size:1rem;outline:none;resize:vertical;min-height:60px;background:#fff}
        .input-controls{display:flex;justify-content:space-between;margin-top:10px}
        .send-btn{background:linear-gradient(to right,#4e54c8,#8f94fb);color:#fff;border:none;border-radius:5px;padding:8px 15px;cursor:pointer;font-size:.9rem;transition:all .3s}
        .send-btn:hover{transform:translateY(-2px)}
        .conversation-section{display:flex;flex-direction:column;padding:15px;gap:15px;flex:1;min-height:400px;background:#f9f9f9}
        .single-conversation{display:flex;flex-direction:column;flex:1}
        .dual-conversation{display:none;gap:15px;flex:1}
        .ai-box{flex:1;border:2px solid #333;border-radius:5px;overflow:hidden;display:flex;flex-direction:column;background:#fff}
        .ai-header{background:linear-gradient(to right,#4e54c8,#8f94fb);color:#fff;padding:10px;display:flex;align-items:center;border-bottom:2px solid #333}
        .ai-avatar{width:30px;height:30px;border-radius:50%;background:#fff;display:flex;justify-content:center;align-items:center;margin-right:10px;font-weight:bold;color:#4e54c8;border:1px solid #333}
        .ai-name{font-weight:bold;font-size:1rem}
        .ai-conversation{flex:1;padding:10px;overflow-y:auto;background:#f9f9f9;min-height:300px;display:flex;flex-direction:column}
        .message{margin-bottom:10px;padding:8px 12px;border-radius:5px;max-width:90%;animation:fadeIn .3s;font-size:.9rem}
        .ai-message{background:#e5e5ea;align-self:flex-start}
        .user-message{background:#007bff;color:#fff;align-self:flex-end}
        @keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
        .summary-section{display:none;padding:15px;border-top:2px solid #333;background:#fff}
        .summary-box{border:2px solid #333;border-radius:5px;padding:10px;background:#f9f9f9}
        .summary-title{font-weight:bold;margin-bottom:10px;color:#4e54c8;font-size:1.1rem}
        .summary-content{padding:10px;background:#fff;border-radius:5px;min-height:60px}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI协作对话系统</h1>
            <p>助手1在需要时召唤助手2，最终提供总结</p>
        </div>
        <div class="input-section">
            <div class="user-input-box">
                <textarea class="user-input" id="userInput" placeholder="输入您的问题或指令..."></textarea>
            </div>
            <div class="input-controls">
                <button class="send-btn" id="clearBtn">清空对话</button>
                <button class="send-btn" id="sendBtn">发送消息</button>
            </div>
        </div>
        <div class="conversation-section">
            <div class="single-conversation" id="singleConversation">
                <div class="ai-box">
                    <div class="ai-header">
                        <div class="ai-avatar">AI1</div>
                        <div class="ai-name">AI助手一号</div>
                    </div>
                    <div class="ai-conversation" id="ai1SingleConversation">
                        <div class="message ai-message">
                            <div class="message-text">您好！我是AI助手一号。我可以处理您的问题，并在需要时召唤助手二号提供专业支持。</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dual-conversation" id="dualConversation">
                <div class="ai-box">
                    <div class="ai-header">
                        <div class="ai-avatar">AI1</div>
                        <div class="ai-name">AI助手一号</div>
                    </div>
                    <div class="ai-conversation" id="ai1DualConversation"></div>
                </div>
                <div class="ai-box">
                    <div class="ai-header">
                        <div class="ai-avatar">AI2</div>
                        <div class="ai-name">AI助手二号</div>
                    </div>
                    <div class="ai-conversation" id="ai2DualConversation"></div>
                </div>
            </div>
        </div>
        <div class="summary-section" id="summarySection">
            <div class="summary-box">
                <div class="summary-title">对话总结</div>
                <div class="summary-content" id="summaryContent"></div>
            </div>
        </div>
    </div>

    <script>
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const clearBtn = document.getElementById('clearBtn');
        const singleConversation = document.getElementById('singleConversation');
        const dualConversation = document.getElementById('dualConversation');
        const ai1SingleConversation = document.getElementById('ai1SingleConversation');
        const ai1DualConversation = document.getElementById('ai1DualConversation');
        const ai2DualConversation = document.getElementById('ai2DualConversation');
        const summarySection = document.getElementById('summarySection');
        const summaryContent = document.getElementById('summaryContent');

        function addMessage(conversationElement, sender, text){
            const msg=document.createElement('div');msg.className=`message ${sender}-message`;
            const txt=document.createElement('div');txt.className='message-text';txt.textContent=text;
            msg.appendChild(txt);conversationElement.appendChild(msg);conversationElement.scrollTop=conversationElement.scrollHeight;
        }
        function copyConversationToDual(){
            ai1DualConversation.innerHTML=ai1SingleConversation.innerHTML;
            ai1SingleConversation.querySelectorAll('.user-message').forEach(m=>ai2DualConversation.appendChild(m.cloneNode(true)));
        }
        function clearConversations(){
            ai1SingleConversation.innerHTML='<div class="message ai-message"><div class="message-text">您好！我是AI助手一号。我可以处理您的问题，并在需要时召唤助手二号提供专业支持。</div></div>';
            ai1DualConversation.innerHTML='';ai2DualConversation.innerHTML='';summaryContent.textContent='';
            singleConversation.style.display='flex';dualConversation.style.display='none';summarySection.style.display='none';
        }

        sendBtn.addEventListener('click',()=>{
            const t=userInput.value.trim();if(!t)return;addMessage(ai1SingleConversation,'user',t);userInput.value='';
            fetch('/api/chat',{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({action:'user',text:t})
            });
        });
        clearBtn.addEventListener('click',clearConversations);

        const ws=new WebSocket('ws://localhost:8000/ws');
        ws.onmessage=e=>{
            const m=JSON.parse(e.data);
            switch(m.action){
                case 'add':
                    const box=m.char==='ai1'?
                        (dualConversation.style.display==='flex'?ai1DualConversation:ai1SingleConversation):
                        ai2DualConversation;
                    addMessage(box,'ai',m.text);break;
                case 'mode':
                    if(m.v==='dual'){singleConversation.style.display='none';dualConversation.style.display='flex';copyConversationToDual();}
                    else{singleConversation.style.display='flex';dualConversation.style.display='none';}
                    break;
                case 'summary':
                    summaryContent.textContent=m.text;summarySection.style.display='block';break;
                case 'clear':
                    clearConversations();break;
            }
        };
    </script>
</body>
</html>